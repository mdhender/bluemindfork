<template>
    <div>
        <bm-list-group v-bm-scrollspy:scroll-area class="pref-right-panel-nav" horizontal>
            <pref-section-navbar v-for="section in sections" :ref="section.id" :key="section.id" :section="section" />
        </bm-list-group>
        <div class="border-bottom border-neutral" />
    </div>
</template>

<script>
import { BmListGroup, BmScrollspy } from "@bluemind/ui-components";
import Navigation from "../mixins/Navigation";
import PrefSectionNavbar from "../PrefSectionNavbar";
import { mapState } from "vuex";

export default {
    name: "PrefRightPanelNav",
    components: {
        BmListGroup,
        PrefSectionNavbar
    },
    directives: { BmScrollspy },
    mixins: [Navigation],
    props: {
        sections: {
            required: true,
            type: Array
        }
    },
    computed: {
        ...mapState("preferences", ["offset"])
    },
    watch: {
        offset() {
            this.moveSectionsNavbar();
        }
    },
    mounted() {
        this.moveSectionsNavbar();
    },
    methods: {
        moveSectionsNavbar() {
            this.sections.forEach(section => {
                const navbar = this.$refs[section.id][0].$el;
                const anchor = document.getElementById("section-" + section.id);
                if (anchor) {
                    const translate = Math.max(Math.min(this.offset - anchor.offsetTop, navbar.offsetHeight), 0);
                    navbar.style.opacity = Math.min(1, translate / navbar.offsetHeight);
                    navbar.style.transform = "translateY(" + -translate + "px)";
                } else {
                    navbar.style.transform = "translateY(-" + navbar.offsetHeight + "px)";
                }
            });
        }
    }
};
</script>

<style lang="scss">
@import "~@bluemind/ui-components/src/css/utils/variables";

.pref-right-panel-nav {
    min-height: 4em;
    position: relative;
    .pref-section-navbar {
        position: absolute;
        top: 4em;
    }
}
</style>
